<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fides et Ratio: Terminal Web</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Atualizado para uma CDN estável do Tau Prolog -->
    <script src="https://cdn.jsdelivr.net/npm/tau-prolog@0.3.2/tau-prolog.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lato', sans-serif; background-color: #FDFBF8; color: #402E32; }
        h1, h2, h3 { font-family: 'Cormorant Garamond', serif; }
        .prolog-terminal { background-color: #1a202c; color: #cbd5e0; font-family: 'Courier New', Courier, monospace; }
        .logic-btn { transition: all 0.2s; border-left: 4px solid transparent; }
        .logic-btn:hover { border-left-color: #A98158; background-color: #F4EFE7; }
    </style>
</head>
<body class="p-4 md:p-10">
    <div class="max-w-5xl mx-auto">
        <header class="mb-10 text-center">
            <h1 class="text-5xl font-bold text-[#402E32]">Fides et Ratio Computatrum</h1>
            <p class="text-[#A98158] italic mt-2">Motor de Inferência Teológica via Navegador</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Coluna de Comandos -->
            <div class="lg:col-span-1 space-y-4">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-[#EAE0D5]">
                    <h3 class="text-2xl font-bold mb-4">Laboratório</h3>
                    <p class="text-sm text-gray-600 mb-6">Selecione uma consulta para o motor processar em tempo real:</p>
                    
                    <div class="space-y-2" id="query-list">
                        <button onclick="runQuery('analisar(trindade).')" class="logic-btn w-full text-left p-3 rounded-lg text-sm font-semibold">
                            ?- analisar(trindade).
                        </button>
                        <button onclick="runQuery('eh_deus(jesus).')" class="logic-btn w-full text-left p-3 rounded-lg text-sm font-semibold">
                            ?- eh_deus(jesus).
                        </button>
                        <button onclick="runQuery('mae_de_deus(maria).')" class="logic-btn w-full text-left p-3 rounded-lg text-sm font-semibold">
                            ?- mae_de_deus(maria).
                        </button>
                    </div>
                </div>

                <div class="bg-[#F4EFE7] p-4 rounded-lg border border-[#D4B491]">
                    <h4 class="font-bold text-sm mb-2">Status do Motor:</h4>
                    <div id="status" class="flex items-center space-x-2 text-xs">
                        <span class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></span>
                        <span>Iniciando...</span>
                    </div>
                </div>
            </div>

            <!-- Coluna do Terminal -->
            <div class="lg:col-span-2">
                <div class="prolog-terminal rounded-xl shadow-2xl overflow-hidden flex flex-col h-[500px]">
                    <div class="bg-gray-800 px-4 py-2 flex items-center justify-between">
                        <span class="text-xs font-bold uppercase tracking-widest text-gray-400">Prolog Output</span>
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        </div>
                    </div>
                    <div id="terminal-content" class="p-6 overflow-y-auto flex-1 text-sm leading-relaxed">
                        Iniciando motor Tau-Prolog...<br>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // O código Prolog é embutido diretamente como uma string para o navegador
        const program = `
            % --- BASES ---
            possui_natureza(jesus, divina).
            mae_de(maria, jesus).
            
            dogma(trindade, 'Santissima Trindade').
            suporte(trindade, 'Joao 1:1').
            
            % --- MOTOR ---
            eh_deus(Pessoa) :- possui_natureza(Pessoa, divina).
            mae_de_deus(X) :- mae_de(X, Filho), eh_deus(Filho).

            analisar(Dogma) :- 
                dogma(Dogma, Nome),
                suporte(Dogma, Ref),
                write('Analisando: '), write(Nome), nl,
                write('Suporte: '), write(Ref), nl,
                write('Status: SOLIDO').
        `;

        let session;
        const terminal = document.getElementById('terminal-content');
        const statusEl = document.getElementById('status');

        window.onload = function() {
            if (typeof pl === "undefined") {
                statusEl.innerHTML = '<span class="w-3 h-3 bg-red-500 rounded-full"></span><span>Erro: Biblioteca não carregada</span>';
                terminal.innerHTML += "Erro fatal: A biblioteca Tau Prolog não pôde ser carregada.<br>";
                return;
            }

            session = pl.create();

            // Configura a captura do 'write' do Prolog para o HTML
            session.standard_output = {
                put_char: function(char) {
                    terminal.innerHTML += char === '\n' ? '<br>' : char;
                },
                flush: function() {}
            };

            // Carrega o programa
            session.consult(program, {
                success: function() {
                    statusEl.innerHTML = '<span class="w-3 h-3 bg-green-500 rounded-full"></span><span>Motor Pronto</span>';
                    terminal.innerHTML += "Base de conhecimento carregada com sucesso.<br>?- ";
                },
                error: function(err) {
                    statusEl.innerHTML = '<span class="w-3 h-3 bg-red-500 rounded-full"></span><span>Erro na Carga</span>';
                    terminal.innerHTML += "Erro ao carregar base: " + err + "<br>";
                }
            });
        };

        function runQuery(queryString) {
            if (!session) return;
            terminal.innerHTML += `<span class="text-yellow-400">${queryString}</span><br>`;
            session.query(queryString, {
                success: function(goal) {
                    session.answer({
                        success: function(answer) {
                            terminal.innerHTML += session.format_answer(answer) + "<br>?- ";
                            terminal.scrollTop = terminal.scrollHeight;
                        },
                        error: function(err) {
                            terminal.innerHTML += "Erro na resposta: " + err + "<br>?- ";
                        },
                        fail: function() {
                            terminal.innerHTML += "false.<br>?- ";
                        }
                    });
                },
                error: function(err) {
                    terminal.innerHTML += "Erro na consulta: " + err + "<br>?- ";
                }
            });
        }
    </script>
</body>
</html>